본 문서는 예비군 동원훈련 중 잔디가 끊기지 않기 위해
코드 대신 개발에 대한 고민과 생각을 정리한 글입니다.

## 실제 서비스를 위해 서버 아키텍처를 어떻게 구성해야할까?
### 1. 적절한 하드웨어 사양
- 서비스의 부하를 감당할 수 있을 정도의 하드웨어 사양이 필요할 듯 싶음
- 그 감당할 수 있을 정도를 수치화하기 위해 실제 사용자 수를 예측해볼 필요가 있음.
- 사용자들 평균 어느정도의 서버 리소스를 사용하는 요청을 보낼건지를 예측해볼 필요가 있음.
- 문제는 시간대별, 상황별로(이벤트 등) 사용자 수가 달라진다는 거임
- 시간대별, 상황별로 사용자가 어느 정도 발생할 것이며, 각 사용자는 어느 정도의 트래픽을 발생시킬 건지가 대략적으로 예측이 되면 부하 테스트를 통해 그에 맞는 하드웨어 사양을 준비할 수 있음
- 시간대별, 상황별로 발생하는 사용자 수와 사용자별 발생 트래픽 양은 서비스를 운영하며 해당 수치들을 지속적으로 기록하여 통계를 통하여 얻을 수 있겠지만, 오픈 전에는 알기가 힘듬
- 그래서 사전 예약이나 베타 테스트 등을 통해 오픈 전에 위와같은 수치들을 얻고자 하는 것으로 보임
- 사용자 수가 시간대별, 상황별로 많이 차이나는 서비스는 아무래도 클라우드 이용이 좋아보임.
- 특정 시간대에만 10만명이 이용하고 나머지 시간대는 1만명 정도가 이용하는 서비스의 경우. 24시간 10만명을 감당할 수 있는 인프라를 운영한다면 비효율적인 운영 비용 지출이 아닐수 없음
- 트래픽 발생에 따라 클라우드 인프라를 스케일 업 하여 사용하는 시스템을 구축하는 것도 좋아보임
- 아니면, 10만명치의 인프라를 구축해놓고 노는 인프라는 다른 사람에게 대여해주는 방식도 괜찮을듯? 그래서 소프트웨어 대기업들이 클라우드 서비스를 하나 싶은 생각도 듬
- 어쨌든 비용 효율적이면서도 서비스 운영에 지장이 없는 인프라를 구축하는 것은 서버 개발자의 숙명..
- 비용 효율성과 안정적 운영 중 그래도 제품 신뢰도가 가장 중요하기에 우선순위를 따지자면 안정적 운영이 더 우선인듯
### 서비스 안정성
- 애플리케이션 코드, 데이터 베이스 데이터 는 백업 필수
- 서비스들도 물리적으로 다른 서버에 이중화하여 운영 하여야 한 곳이 잘못되도 지속적 서비스가 가능
- 결제나 돈 관련된 api들은 처리 중 문제가 생기면 안되므로 (성공하거나 실패처리가 완료 되어야 함) 이벤트 큐 등에 넣어서 처리 도중 문제가 생겨도 재시도를 하거나 할 수 있도록 방안을 강구해야 함
- 이벤트 큐를 쓰면, 여러 애플리케이션이 이벤트들을 분산 처리할 수 있다는 장점이 있음. 도커등 컨테이너 수평적 확장에 궁합이 잘 맞을듯
- api들 트랜잭션 처리도 잘 해주어야 한다. 애플리케이션 단에서 orm으로 잘 처리하자
### 보안
- 우선 sop설정을 통한 CSRF 공격 방어와
- 서버측에서 사용자 데이터 저장 시 SQL 검증, HttpOnly 쿠키 설정 등을 통하여 XSS 공격을 예방할 필요가 있다.
- web server 를 사용하여 ws만 외부에 노출하고 나머지 was, db 등은 외부에 노출하지 않는 것이 보안적으로 좋다.
- https는 필수
- 서버에는 필요한 포트만 노출시키자
- 서버의 ssh 서버는 key 인증을 추천한다.
- 디도스 공격 패턴을 감지하여 자동으로 착단하는 룰을 사용하는 보안 앱 사용을 추천한다.
- waf를 사용하여 애플리케이션 단에서 사용자의 요청을 감증하는것도 필요하다.
- selinux를 통해 서버 유저들의 권한 남용을 방지하고 프러세스와 리소스의 커뮤니케이션을 통제하여 여러 보안 해킹을 방지한다
- db의 중요한 데이터들은 해시 혹은 암호화 해서 저장하고 해당 암호화 키를 db와 다른 곳에 보관함으로서 혹시 모를 보안사고릉 예방한다.
- 항상 루트 권한을 잘 관리하여 외부 혹은 내부자들로부터의 보안 사고를 예방한다.
